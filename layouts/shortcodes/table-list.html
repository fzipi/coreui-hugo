
{{  $type   := .Get "type"                                             }}
{{  $when   := (add ".Params." (.Get "when"))                          }}
{{  $is     := .Get "is"                                               }}
{{  $fields := split (.Get "fields") ","                               }}  {{/* $fields := split (default (.Get "fields") "title") ","   */}}  {{/* bug: default value not working (idea is to default to title when no value is provided) */}}

{{  if ne $type ""                                                     }}
{{      .Scratch.Set "pages" (where .Site.Pages "Type" $type)          }}
{{  else                                                               }}
{{      .Scratch.Set "pages" .Site.Pages                               }}
{{  end                                                                }}

{{  if ne $is ""                                                       }}
{{      .Scratch.Set "rows" (where (.Scratch.Get "pages") $when $is)   }}
{{  else                                                               }}
{{      .Scratch.Set "rows" (.Scratch.Get "pages")                     }}
{{  end                                                                }}


<div class="card">
    <div class="card-body">
        <table class="table" style="background:white;">
            <thead>
                {{ range $fields}}
                    <th>{{ . }}</th>
                {{ end }}
            </thead>
            <tbody>
                {{ range .Scratch.Get "rows" }}
                    {{ $row := . }}
                    <tr>
                        {{ range $fields}}
                            <td>{{ index $row.Params (lower .) }}</td>
                        {{ end }}
                    </tr>
                {{ end }}
            </tbody>
        </table>
    </div>
</div>